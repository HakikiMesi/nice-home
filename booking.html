<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Booking – Nice Home</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
        padding: 20px;
    }
    h2 { text-align: center; }
    form {
        max-width: 420px;
        margin: auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
    }
    input, select {
        width: 100%;
        padding: 10px;
        margin: 6px 0;
        border-radius: 6px;
        border: 1px solid #ccc;
    }
    button {
        width: 100%;
        padding: 12px;
        border: none;
        background: #0a7cff;
        color: white;
        font-weight: bold;
        border-radius: 6px;
    }
</style>
</head>
<body>

<h2>Booking Form – Nice Home Villa</h2>

<form id="bookingForm">
    <label>Nama Lengkap</label>
    <input type="text" id="nama" required>

    <label>Nomor WhatsApp</label>
    <input type="text" id="wa" required>

    <label>Tanggal Check-in</label>
    <input type="date" id="checkin" required>

    <label>Tanggal Check-out</label>
    <input type="date" id="checkout" required>

    <label>Jumlah Tamu</label>
    <input type="number" id="tamu" required>

    <label>Metode Pembayaran</label>
    <select id="metode">
        <option value="BRI">Transfer BRI a/n Rolland Roy Hakiki (723201006379536)</option>
        <option value="QRIS">QRIS</option>
    </select>

    <label>Upload Bukti Pembayaran</label>
    <input type="file" id="bukti" accept="image/*" required>

    <button type="submit">Kirim Booking</button>
</form>

<p id="status" style="text-align:center; margin-top:15px;"></p>

<!-- FIREBASE -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";
    import { getStorage, uploadBytes, getDownloadURL, ref as sRef } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-storage.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDcKXGI6qDFOLHBFLUJldlUKsEn55P7aiw",
        authDomain: "nicehome-bf539.firebaseapp.com",
        databaseURL: "https://nicehome-bf539-default-rtdb.firebaseio.com",
        projectId: "nicehome-bf539",
        storageBucket: "nicehome-bf539.appspot.com",   // ← INI WAJIB DIBETULKAN
        messagingSenderId: "88440053120",
        appId: "1:88440053120:web:d2a8256dee31447fb4f565",
        measurementId: "G-6XY1SY1ER1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const storage = getStorage(app);

    document.getElementById("bookingForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const nama = document.getElementById("nama").value;
        const wa = document.getElementById("wa").value;
        const checkin = document.getElementById("checkin").value;
        const checkout = document.getElementById("checkout").value;
        const tamu = document.getElementById("tamu").value;
        const metode = document.getElementById("metode").value;
        const file = document.getElementById("bukti").files[0];

        document.getElementById("status").textContent = "Mengupload bukti pembayaran...";

        try {
            // Upload bukti
            const storagePath = sRef(storage, "bukti/" + Date.now() + "-" + file.name);
            await uploadBytes(storagePath, file);
            const url = await getDownloadURL(storagePath);

            // Simpan ke database
            const bookingRef = ref(db, "bookings");
            const newBooking = push(bookingRef);

            await set(newBooking, {
                nama, wa, checkin, checkout, tamu, metode,
                buktiURL: url,
                tanggalSubmit: new Date().toISOString()
            });

            document.getElementById("status").textContent = "Booking berhasil dikirim!";
            document.getElementById("bookingForm").reset();

        } catch (err) {
            document.getElementById("status").textContent = "Terjadi kesalahan: " + err.message;
            console.error(err);
        }
    });
</script>


</body>
</html>
